# ========================================
# CONFIGURAÇÃO SUPABASE NO EASYPANEL
# ========================================

## PROBLEMA IDENTIFICADO:
As variáveis de ambiente não estão sendo aplicadas no container do Supabase.

## SOLUÇÃO:

### 1. ACESSO AO EASYPANEL:
- URL: https://easypanel.io (ou seu painel)
- Projeto: nsecops-ness-supabase
- Serviço: Supabase

### 2. CONFIGURAÇÃO DE VARIÁVEIS:
Vá em: **Supabase > Environment Variables** ou **Variables**

### 3. VARIÁVEIS OBRIGATÓRIAS (adicione uma por uma):

```bash
# DATABASE
POSTGRES_PASSWORD=your-super-secret-and-long-postgres-password
POSTGRES_HOST=db
POSTGRES_DB=postgres
POSTGRES_PORT=5432

# SECRETS
JWT_SECRET=your-super-secret-jwt-token-with-at-least-32-characters-long
SECRET_KEY_BASE=UpNVntn3cDxHJpq99YMc1T1AQgQpc8kfYTuRgBiYa15BLrx8etQoXz3gZv1/u2oq
VAULT_ENC_KEY=your-encryption-key-32-chars-min

# API
PGRST_DB_SCHEMAS=public,storage,graphql_public
FUNCTIONS_VERIFY_JWT=false

# AUTH
JWT_EXPIRY=3600
DISABLE_SIGNUP=false
ENABLE_ANONYMOUS_USERS=false

# DASHBOARD
DASHBOARD_USERNAME=supabase
DASHBOARD_PASSWORD=this_password_is_insecure_and_should_be_updated

# POOLER
POOLER_TENANT_ID=your-tenant-id
POOLER_DEFAULT_POOL_SIZE=20
POOLER_MAX_CLIENT_CONN=100

# LOGGING
LOGFLARE_API_KEY=your-super-secret-and-long-logflare-key
DOCKER_SOCKET_LOCATION=/var/run/docker.sock

# STUDIO
STUDIO_DEFAULT_ORGANIZATION=Default Organization
STUDIO_DEFAULT_PROJECT=Default Project

# EMAIL (opcional)
ENABLE_EMAIL_SIGNUP=true
ENABLE_EMAIL_AUTOCONFIRM=true
ENABLE_PHONE_SIGNUP=true
ENABLE_PHONE_AUTOCONFIRM=true

# SMTP (opcional)
SMTP_ADMIN_EMAIL=admin@ness.tec.br
SMTP_HOST=seu-smtp.ness.tec.br
SMTP_PORT=587
SMTP_USER=seu-email@ness.tec.br
SMTP_PASS=sua-senha-smtp
SMTP_SENDER_NAME=n.CISO Platform

# MAILER URLS (opcional)
MAILER_URLPATHS_RECOVERY=
MAILER_URLPATHS_EMAIL_CHANGE=
MAILER_URLPATHS_INVITE=
MAILER_URLPATHS_CONFIRMATION=

# REDIRECTS
ADDITIONAL_REDIRECT_URLS=

# IMAGE PROCESSING
IMGPROXY_ENABLE_WEBP_DETECTION=
```

### 4. APÓS ADICIONAR AS VARIÁVEIS:

1. **Salve as configurações**
2. **Reinicie o serviço Supabase**
3. **Verifique os logs** - não deve haver mais warnings
4. **Teste a conexão** com a aplicação

### 5. VERIFICAÇÃO:

```bash
# Teste se o Supabase está respondendo
curl -s https://nsecops-ness-supabase.pzgnh1.easypanel.host/rest/v1/ \
  -H "apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UtZGVtbyIsCiAgICAiaWF0IjogMTY0MTc2OTIwMCwKICAgICJleHAiOiAxNzk5NTM1NjAwCn0.dc_X5iR_VP_qT0zsiyj_I_OZ2T9FtRU2BBNWN8Bu4GE"

# Teste o health check da aplicação
curl -s https://ncagent.ness.tec.br/api/health
```

### 6. PROBLEMA DO DOCKER SOCKET:

O erro `invalid spec: :/var/run/docker.sock:ro,z: empty section between colons` indica problema na configuração de volumes.

**Solução no Easypanel:**
- Vá em **Supabase > Volumes**
- Verifique se há volumes mal configurados
- Remova ou corrija volumes com `:/var/run/docker.sock:ro,z`

### 7. ALTERNATIVA - USAR DOCKER COMPOSE:

Se o Easypanel não estiver funcionando, você pode usar o docker-compose local:

```bash
# No diretório do projeto
docker-compose up -d supabase
```

### 8. PRÓXIMOS PASSOS:

Após resolver os warnings:
1. Executar scripts SQL para criar tabelas
2. Criar buckets de storage
3. Testar funcionalidades da aplicação
